services:
  exchange:
    build:
      context: ./exchange
    container_name: exchange
    environment:
    - PORT=8000
    ports:
    - 8000:8000
    healthcheck:
      test:
      - CMD
      - python
      - -c
      - import urllib.request; urllib.request.urlopen('http://localhost:8000/health')
      interval: 5s
      timeout: 2s
      retries: 20
  app:
    build:
      context: ./app
    container_name: app
    depends_on:
      exchange:
        condition: service_healthy
    environment:
    - EXCHANGE_BASE_URL=http://exchange:8000
    - EXCHANGE_POLL_INTERVAL_MS=1000
    - EXCHANGE_FILL_WORKER_ENABLED=true
    ports:
    - 8080:8080
